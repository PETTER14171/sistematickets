(()=>{"use strict";function e(){const e=document.getElementById("notiResumen")||document.getElementById("alertaDinamica");e&&fetch("notificaciones_alerta.php").then(e=>e.json()).then(t=>{if(!t||!t.ok)return;const n=Number(t.unread||0),o=t.top_priority||null,i=t.latest||null;if(e.innerHTML=function(e,t){const n=function(e){const t=(e||"").toLowerCase();return"alta"===t?"Alta":"media"===t?"Media":"baja"===t?"Baja":"Info"}(t),o=function(e){const t=(e||"").toLowerCase();return"alta"===t?"‚ö†Ô∏è":"media"===t?"üîî":"baja"===t?"‚ÑπÔ∏è":"üîî"}(t);return!e||e<=0?'<p class="admin-card__empty">Sin notificaciones pendientes.</p>':`\n    <div class="admin-noti-summary__box admin-noti-summary__box--${(t||"media").toLowerCase()}">\n      <div class="admin-noti-summary__icon">${o}</div>\n      <div class="admin-noti-summary__content">\n        <div class="admin-noti-summary__title">Tienes notificaciones pendientes</div>\n        <div class="admin-noti-summary__meta">\n          <span class="admin-noti-summary__count">${e}</span>\n          <span class="admin-noti-summary__sep">‚Ä¢</span>\n          <span class="admin-noti-summary__prio">Con Prioridad: ${n}</span>\n        </div>\n      </div>\n    </div>\n  `}(n,o),!i||!i.id)return;const a="lastNotiId_seen",s=Number(localStorage.getItem(a)||0);if(i.id>s&&(localStorage.setItem(a,String(i.id)),"Notification"in window&&"granted"===Notification.permission)){const e=`TalkHub: ${n} pendiente(s)`,t=i.mensaje?i.mensaje:"Tienes una nueva notificaci√≥n.",o=new Notification(e,{body:t});i.ticket_id&&(o.onclick=()=>{window.focus(),window.location.href=`responder_ticket.php?id=${i.ticket_id}`})}}).catch(e=>console.error("Error al consultar notificaciones:",e))}function t(e){const t=document.getElementById("modal-falla-"+e);t&&(t.style.display="none",document.body.style.overflow="",t._onEsc&&(document.removeEventListener("keydown",t._onEsc),delete t._onEsc))}console.log("APP BUILD: 2025-12-12"),function(){const e=document.getElementById("btnEnableNotifications");if(!e)return;const t="Notification"in window;function n(t){t?(e.classList.add("is-enabled"),e.setAttribute("aria-label","Notificaciones activadas"),e.title="Notificaciones activadas"):(e.classList.remove("is-enabled"),e.setAttribute("aria-label","Activar notificaciones del navegador"),e.title="Activar notificaciones del navegador")}if(!t)return e.disabled=!0,void(e.title="Tu navegador no soporta notificaciones");n("granted"===Notification.permission),e.addEventListener("click",async()=>{if(t)if("granted"!==Notification.permission)if("denied"!==Notification.permission)try{const e=await Notification.requestPermission();"granted"===e?(n(!0),Swal.fire({icon:"success",title:"¬°Listo!",text:"Notificaciones activadas. Te avisar√© cuando haya nuevos eventos.",timer:1800,showConfirmButton:!1}),new Notification("TalkHub",{body:"Notificaciones activadas correctamente ‚úÖ"})):"denied"===e?(n(!1),Swal.fire({icon:"error",title:"Permiso rechazado",text:"No podr√© mostrar notificaciones del navegador a menos que las habilites.",confirmButtonText:"OK"})):(n(!1),Swal.fire({icon:"warning",title:"Sin cambios",text:"No se otorg√≥ el permiso. Puedes intentarlo de nuevo cuando quieras.",confirmButtonText:"OK"}))}catch(e){Swal.fire({icon:"error",title:"Error al solicitar permiso",text:"Ocurri√≥ un problema al solicitar notificaciones.",confirmButtonText:"OK"})}else Swal.fire({icon:"error",title:"Notificaciones bloqueadas",html:"\n          Tu navegador tiene las notificaciones <b>bloqueadas</b>.<br><br>\n          Para habilitarlas: abre el candado üîí en la barra de direcciones ‚Üí Notificaciones ‚Üí Permitir.\n        ",confirmButtonText:"Entendido"});else Swal.fire({icon:"info",title:"Ya est√°n activadas",text:"Las notificaciones del navegador ya est√°n permitidas.",confirmButtonText:"OK"})})}(),setInterval(e,2e3),e(),window.abrirModalNotificaciones=abrirModalNotificaciones,window.cerrarModal=cerrarModal,window.marcarNotificacionesLeidas=marcarNotificacionesLeidas,window.abrirModalFalla=function(e){const n=document.getElementById("modal-falla-"+e);if(!n)return;n.style.display="flex",document.body.style.overflow="hidden",n.addEventListener("click",function(o){o.target===n&&t(e)},{once:!0});const o=n=>{"Escape"===n.key&&t(e)};n._onEsc=o,document.addEventListener("keydown",o)},window.cerrarModalFalla=t})(),document.addEventListener("DOMContentLoaded",()=>{const e=document.querySelector(".js-pdf-frame"),t=document.querySelector(".js-pdf-zoom-label"),n=document.querySelector(".js-pdf-zoom-in"),o=document.querySelector(".js-pdf-zoom-reset"),i=document.querySelector(".js-pdf-search-tip");if(!(e&&t&&n&&o))return;let a=1;function s(){e.style.transform=`scale(${a})`,e.style.transformOrigin="top center",t.textContent=`${Math.round(100*a)}%`}s(),n.addEventListener("click",()=>{a=Math.min(2,+(a+.1).toFixed(2)),s()}),o.addEventListener("click",()=>{a=1,s()}),document.addEventListener("keydown",e=>{const t=e.ctrlKey||e.metaKey;!t||"+"!==e.key&&"="!==e.key||(e.preventDefault(),a=Math.min(2,+(a+.1).toFixed(2)),s()),t&&"-"===e.key&&(e.preventDefault(),a=Math.max(.6,+(a-.1).toFixed(2)),s()),t&&"0"===e.key&&(e.preventDefault(),a=1,s())}),i&&i.addEventListener("click",()=>{alert("Tip: usa Ctrl + F (Cmd + F en Mac) para buscar dentro del documento.")})}),document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll(".js-card-link").forEach(e=>{const t=e.dataset.link;t&&(e.classList.add("admin-card--clickable"),e.addEventListener("click",()=>{window.location.href=t}))});const e=document.querySelector(".js-admin-search");e&&e.addEventListener("click",()=>{const e=window.prompt("Buscar tickets por t√≠tulo o descripci√≥n:");if(e&&""!==e.trim()){const t=encodeURIComponent(e.trim());window.location.href=`admin_tickets.php?q=${t}`}});const t=document.querySelector(".js-admin-bell"),n=document.querySelector(".js-notifications-wrapper");t&&n&&t.addEventListener("click",()=>{n.scrollIntoView({behavior:"smooth",block:"start"}),n.classList.add("admin-card--highlight"),setTimeout(()=>{n.classList.remove("admin-card--highlight")},1800)});const o=document.querySelector(".js-notifications-list");if(o){o.querySelectorAll(".admin-notifications__item").length>5&&o.classList.add("has-scroll")}}),document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("navToggle"),t=document.getElementById("mainNav");e&&t&&(e.addEventListener("click",()=>{const n=t.classList.toggle("open");e.setAttribute("aria-expanded",n?"true":"false")}),t.querySelectorAll("a").forEach(n=>{n.addEventListener("click",()=>{window.innerWidth<=900&&t.classList.contains("open")&&(t.classList.remove("open"),e.setAttribute("aria-expanded","false"))})}),window.addEventListener("resize",()=>{window.innerWidth>900&&t.classList.contains("open")&&(t.classList.remove("open"),e.setAttribute("aria-expanded","false"))}),document.addEventListener("keydown",n=>{"Escape"===n.key&&t.classList.contains("open")&&(t.classList.remove("open"),e.setAttribute("aria-expanded","false"))}))}),document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("ticketMessages"),t=document.querySelector(".ticket-thread__form");if(!e||!t)return;const n=t.querySelector("#mensaje"),o=t.querySelector("#archivo_adjunto");function i(t){e.dataset.lastId=String(t)}function a(e={}){const t=new URL(window.location.href);t.searchParams.set("ajax","1");for(const[n,o]of Object.entries(e))t.searchParams.set(n,o);return t.toString()}t.addEventListener("submit",function(s){s.preventDefault();const r=new FormData(t);r.set("accion","mensaje_nuevo"),fetch(a(),{method:"POST",body:r,headers:{"X-Requested-With":"XMLHttpRequest"}}).then(e=>e.json()).then(t=>{t&&t.ok?(t.html&&e.insertAdjacentHTML("beforeend",t.html),t.last_id&&i(t.last_id),n&&(n.value=""),o&&(o.value=""),e.scrollTop=e.scrollHeight):alert(t&&t.error?t.error:"Error al enviar el mensaje.")}).catch(e=>{console.error(e),alert("Error de conexi√≥n al enviar el mensaje.")})}),setInterval(function(){const t=parseInt(e.dataset.lastId||"0",10);fetch(a({action:"list",last_id:String(t)}),{headers:{"X-Requested-With":"XMLHttpRequest"}}).then(e=>e.json()).then(n=>{n&&n.ok&&(n.html&&e.insertAdjacentHTML("beforeend",n.html),n.last_id&&n.last_id>t&&(i(n.last_id),e.scrollTop=e.scrollHeight))}).catch(e=>{console.error("Error al consultar nuevos mensajes",e)})},1e3)}),document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll(".js-eliminar-usuario").forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();const t=this.getAttribute("href");Swal.fire({title:"¬øEliminar usuario?",text:"El usuario ser√° desactivado y ya no aparecer√° en la lista.",icon:"warning",showCancelButton:!0,confirmButtonText:"S√≠, eliminar",cancelButtonText:"Cancelar",reverseButtons:!0,confirmButtonColor:"#dc2626",cancelButtonColor:"#6b7280"}).then(e=>{e.isConfirmed&&(window.location.href=t)})})})}),document.addEventListener("DOMContentLoaded",function(){const e=document.querySelector(".ticket-thread__form");if(!e)return;const t=document.getElementById("mensaje"),n=document.getElementById("archivo_adjunto");t&&n&&(n.addEventListener("change",function(){const e=t.value.trim().length>0;n.files.length>0&&!e&&(Swal.fire({icon:"warning",title:"Mensaje requerido",text:"Para adjuntar evidencia, primero escribe un mensaje.",confirmButtonColor:"#3085d6"}),n.value="",t.focus())}),e.addEventListener("submit",function(e){t.value.trim().length>0||(e.preventDefault(),Swal.fire({icon:"warning",title:"Mensaje vac√≠o",text:"El mensaje no puede estar vac√≠o.",confirmButtonColor:"#3085d6"}),t.focus())}))}),function(e,t){function n(e,t){return typeof e===t}function o(e){var t=l.className,n=c._config.classPrefix||"";if(u&&(t=t.baseVal),c._config.enableJSClass){var o=new RegExp("(^|\\s)"+n+"no-js(\\s|$)");t=t.replace(o,"$1"+n+"js$2")}c._config.enableClasses&&(t+=" "+n+e.join(" "+n),u?l.className.baseVal=t:l.className=t)}function i(e,t){if("object"==typeof e)for(var n in e)d(e,n)&&i(n,e[n]);else{var a=(e=e.toLowerCase()).split("."),s=c[a[0]];if(2==a.length&&(s=s[a[1]]),void 0!==s)return c;t="function"==typeof t?t():t,1==a.length?c[a[0]]=t:(!c[a[0]]||c[a[0]]instanceof Boolean||(c[a[0]]=new Boolean(c[a[0]])),c[a[0]][a[1]]=t),o([(t&&0!=t?"":"no-")+a.join("-")]),c._trigger(e,t)}return c}var a=[],s=[],r={_version:"3.6.0",_config:{classPrefix:"",enableClasses:!0,enableJSClass:!0,usePrefixes:!0},_q:[],on:function(e,t){var n=this;setTimeout(function(){t(n[e])},0)},addTest:function(e,t,n){s.push({name:e,fn:t,options:n})},addAsyncTest:function(e){s.push({name:null,fn:e})}},c=function(){};c.prototype=r,c=new c;var d,l=t.documentElement,u="svg"===l.nodeName.toLowerCase();!function(){var e={}.hasOwnProperty;d=n(e,"undefined")||n(e.call,"undefined")?function(e,t){return t in e&&n(e.constructor.prototype[t],"undefined")}:function(t,n){return e.call(t,n)}}(),r._l={},r.on=function(e,t){this._l[e]||(this._l[e]=[]),this._l[e].push(t),c.hasOwnProperty(e)&&setTimeout(function(){c._trigger(e,c[e])},0)},r._trigger=function(e,t){if(this._l[e]){var n=this._l[e];setTimeout(function(){var e;for(e=0;e<n.length;e++)(0,n[e])(t)},0),delete this._l[e]}},c._q.push(function(){r.addTest=i}),c.addAsyncTest(function(){function e(e,t,n){function o(t){var o=!(!t||"load"!==t.type)&&1==a.width;i(e,"webp"===e&&o?new Boolean(o):o),n&&n(t)}var a=new Image;a.onerror=o,a.onload=o,a.src=t}var t=[{uri:"data:image/webp;base64,UklGRiQAAABXRUJQVlA4IBgAAAAwAQCdASoBAAEAAwA0JaQAA3AA/vuUAAA=",name:"webp"},{uri:"data:image/webp;base64,UklGRkoAAABXRUJQVlA4WAoAAAAQAAAAAAAAAAAAQUxQSAwAAAABBxAR/Q9ERP8DAABWUDggGAAAADABAJ0BKgEAAQADADQlpAADcAD++/1QAA==",name:"webp.alpha"},{uri:"data:image/webp;base64,UklGRlIAAABXRUJQVlA4WAoAAAASAAAAAAAAAAAAQU5JTQYAAAD/////AABBTk1GJgAAAAAAAAAAAAAAAAAAAGQAAABWUDhMDQAAAC8AAAAQBxAREYiI/gcA",name:"webp.animation"},{uri:"data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA=",name:"webp.lossless"}],n=t.shift();e(n.name,n.uri,function(n){if(n&&"load"===n.type)for(var o=0;o<t.length;o++)e(t[o].name,t[o].uri)})}),function(){var e,t,o,i,r,d;for(var l in s)if(s.hasOwnProperty(l)){if(e=[],(t=s[l]).name&&(e.push(t.name.toLowerCase()),t.options&&t.options.aliases&&t.options.aliases.length))for(o=0;o<t.options.aliases.length;o++)e.push(t.options.aliases[o].toLowerCase());for(i=n(t.fn,"function")?t.fn():t.fn,r=0;r<e.length;r++)1===(d=e[r].split(".")).length?c[d[0]]=i:(!c[d[0]]||c[d[0]]instanceof Boolean||(c[d[0]]=new Boolean(c[d[0]])),c[d[0]][d[1]]=i),a.push((i?"":"no-")+d.join("-"))}}(),o(a),delete r.addTest,delete r.addAsyncTest;for(var m=0;m<c._q.length;m++)c._q[m]();e.Modernizr=c}(window,document);
//# sourceMappingURL=bundle.js.map
